---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# geofabric

<!-- badges: start -->
<!-- badges: end -->

The goal of geofabric is to make it easier for open source software users to access freely available, community created geographic data, in the form of OpenSteetMap data shipped by [Geofabrik GmbH](http://download.geofabrik.de).

## Installation

<!-- You can install the released version of geofabric from [CRAN](https://CRAN.R-project.org) with: -->

<!-- ``` r -->
<!-- install.packages("geofabric") -->
<!-- ``` -->
You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ITSLeeds/geofabric")
```
## Usage

Give geofabric the name of a geofabric zone and it will download and import it.
By default it imports the 'lines' layer, but any layer can be read-in.

```{r example}
library(geofabric)
andorra_lines = get_geofabric(name = "andorra", layer = "lines")
andorra_point = get_geofabric(name = "andorra", layer = "points")
plot(andorra_lines$geometry)
plot(andorra_point, add = TRUE)
```

If there are no files available for a zone name, geofabric will search for and import the nearest matching zone:

```{r matching}
iow_lines = get_geofabric(name = "isle wight")
plot(iow_lines$geometry) # note the lines contain ferry services to france and elsewhere
```

Take care: files downloaded from geofabrik can be large.

# geofabrik zones

The package ships with a data frame representing all zones made available by the package.
These can be interactively searched with the following command:

```{r, eval=FALSE}
View(sf::st_drop_geometry(geofabric_zones[1:3]))
```

That will display the following table in the viewer:

```{r viewer, echo=FALSE}
knitr::kable(sf::st_drop_geometry(geofabric_zones[1:4, 1:3]))
```

The following attributes are available from this file if you want more info about each geofabric zone:

```{r cols}
names(geofabric_zones)
```

Each geographic level (continents, countries, regions and subregions) is shown in the map below, with a few of them named for reference.

```{r zonemap, echo=FALSE}
library(tmap)
sel1 = is.na(geofabric_zones$level)
geofabric_zones$level[sel1] = 1
geofabric_zones$label = ""
geofabric_zones$label[sel1] = geofabric_zones$name[sel1]
set.seed(9)
sel2 = sample(x = 1:nrow(geofabric_zones), size = 5)
geofabric_zones$label[sel2] = geofabric_zones$name[sel2]
tm_shape(geofabric_zones) +
  tm_polygons() +
  tm_text(text = "label") +
  tm_facets(by = "level")
```

A couple of the countries, regions and sub regions available is shown below.

```{r viewer-countries}
geofabric_countries = geofabric_zones[geofabric_zones$level == 2, ]
knitr::kable(sf::st_drop_geometry(geofabric_countries[1:2, 1:3]))
```

```{r viewer-regions}
geofabric_regions = geofabric_zones[geofabric_zones$level == 3, ]
knitr::kable(sf::st_drop_geometry(geofabric_regions[1:2, 1:3]))
```

```{r viewer-subregions}
geofabric_subregions = geofabric_zones[geofabric_zones$level == 4, ]
knitr::kable(sf::st_drop_geometry(geofabric_subregions[1:2, 1:3]))
```

```{r old, echo=FALSE, eval=FALSE}
get_geofabric(continent = "europe", country = "great-britain")
# Download a specific region as follows:
# get_geofabric(continent = "europe", country = "great-britain", region = "wales")
# get_geofabric(continent = "europe", country = "italy", region = "nord-este")
```

