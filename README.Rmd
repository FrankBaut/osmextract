---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Load package 

```{r}
library(osmextractr)
```

The packages is composed by 4 main functions: 

1. `osmext_match`: Match the input zone with one of the files stored by the OSM providers
2. `osmext_download`: Download the chosen file
3. `osmext_vectortranslate`: Convert the pbf format into gpkg
4. `osmext_read`: Read the gpkg file

The function `osmext_get` is a wrapper around all of them. 

# Test `osmext_match`

The simplest example: 

```{r}
osmext_match("Italy")
```

There are several situations where it could be difficult to find the appropriate data source due to several small differences in the official names: 

```{r, error = TRUE}
osmext_match("Korea")
osmext_match("Russia")
```

For these reasons we implemented the possibility to look for the appropriate area according to the [iso3166-1 alpha2](https://it.wikipedia.org/wiki/ISO_3166-1_alpha-2) code: 

```{r}
osmext_match("KP", match_by = "iso3166_1_alpha2")
osmext_match("RU", match_by = "iso3166_1_alpha2")
osmext_match("US", match_by = "iso3166_1_alpha2")
```

We also created a function that let you explore the matching variables according to a chosen pattern, for example: 

```{r}
osmext_check_pattern("London", provider = "geofabrik", match_by = "name")
osmext_check_pattern("Russia", provider = "geofabrik", match_by = "name")
osmext_check_pattern("Korea", provider = "geofabrik", match_by = "name")
osmext_check_pattern("Yorkshire", provider = "geofabrik", match_by = "name")
```

The input `place` can be also specified using an `sfc_POINT` object with arbitrary CRS as documented in the following example. If there are multiple matches, the function returns the smallest area (according to the `level` variable). I would ignore the CRS warning for the moment. 

```{r}
coords_milan = sf::st_point(c(1514924.21, 5034552.92)) # Duomo di Milano
st_sfc_milan = sf::st_sfc(coords_milan, crs = 3003)
osmext_match(st_sfc_milan)
```

The input `place` can be also specified using a numeric vector of coordinates. In that case the CRS is assumed to be 4326:

```{r, error = TRUE}
osmext_match(c(9.1916, 45.4650)) # Duomo di Milano
osmext_match(c(9.1916))
osmext_match(c(9.1916, 45.4650, 9.2020, 45.4781))
```

If there are several error matching the input place with one of the zone, you can also try increasing the maximum allowed string distance: 

```{r, error = TRUE}
osmext_match("Isle Wight")
osmext_match("Isle Wight", max_string_dist = 3)
```

# Test download

```{r, eval = FALSE}
iow = osmext_match("Isle Wight", max_string_dist = 3)
osmext_download(
  file_url = iow$pbf_url, 
  file_size = iow$pbf_file_size
)
```
